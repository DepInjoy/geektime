数据模型可以看到其包含数据结构，数据操作和数据上的约束。为了开始学习关系上的数据操作需要引入一种专门的代数--关系代数，它包含一些简单但功能强大的方法，可以从给定关系构造出新的关系。当给定关系是真正被系统存储的数据(表)时，构造出的信管系也可以是对这些数据查询而产生的结果。

<b><font color="orange">为什么需要一种专门的查询语言？</font></b>

关系代数不如C或Java强大，它通过对查询语言做出某种限制，可以获得两个极为有益的回报--可以**非常方便地进行开发以及能够编译产生高度优化的代码。** 那么，什么是代数？

**一门代数通常由一些操作符和一些原子操作数组成**，例如算术代数中原子操作数变量`x`和常量15，加、减、乘、除是操作符。任何一门代数都允许将操作符作用在原子操作数或其他代数表达式上构造表达式(expression)，一般括号用来组合操作符和操作数，例如`(x+y)*z`。

<div>
    <b>
        <font color="green">关系代数的原子操作数是：
        <ol>
            <li>代表关系的变量</li>
            <li>代表有限关系的常量</li>
        </ol>
        接下来，来了解关系代数的操作符
        </font>
    </b>
</div>

关系代数操作以一个或多个关系为输入，结果是一个新的关系。它用关系的运算来表达查询具有一定的过程性，也是一种抽象的语言。关系代数操作包含集合操作和纯关系操作

- 集合操作，其中有
    - 通常的关系操作：UNION(并) $R \cup S$; Intersection(交) $R \cap S $ ; Difference(差) $R - S$; 
    - 结合两个关系元组的操作：Cartesian Product(笛卡尔积) $R \times S$，当然，对两个关系元组结合还包含其他的Join操作。
- 纯关系操作，其中有
    - 除去某些行或列的操作：Project(投影) $\pi_A(R)$， Select(选择) $\sigma_{con}(R)$。其中，选择是消除某些行(元组)，投影是消除某些列的操作。
    -  重命名(renaming)操作，它不影响关系中的元组，但它改变了关系模式，即属性的名称或关系的名称。
    - Join(连接) $R \Join_{A \theta B} S$; Division(除) $R \div S $

一般将关系代数的表达式称为查询(query)。

# 运算约束

## 并相容性

某些关系代数操作，如并、差、交等，需满足“并相容性”。

并相容性：参与运算的两个关系及其相关属性之间有一定的对应性、可比性或意义关联性.

定义：关系R与关系S存在相容性，当且仅当：

1. 关系R和关系S的属性数目必须相同
2. 对于任意i，关系R的第i个属性的域必须和关系S的第i个属性的域相同

假设：$R(A_{1}, A_{2}, … , A_{n})$ , $S(B_{1}, B_{2}, … ,B_{m})$，$R$和$S$满足并相容性：$n = m$ 且 $Domain(A_{i}) = Domain(B_{i})$。

# 基本操作

并、交、差、广义笛卡尔积、选择和投影是关系代数的基本操作。


## 并(Union)
定义：假设关系$R$和关系$S$是并相容的，则关系$R$与关系$S$的并运算结果也是一个关系，记作：$R \cup S$, 它由或者出现在关系R中，或者出现在S中的元 组构成。其数学描述：
$$
\begin{array}{l}
R \cup S = \{t | t \in R \vee t \in S \}\\
其中，t是元组
\end{array} 
$$
并运算是将两个关系的元组合并成一个关系，在合并时去掉重复的元组。 
$R \cup S$与$S \cup R$运算的结果是同一个关系


## 差(Difference)
定义：假设关系$R$和关系$S$是并相容的，则关系$R$与关系$S$的差运算结果
也是一个关系，记作：$R -S$, 它由出现在关系R中但不出现在关系S中的元组构成。其数学描述:
$$
\begin{array}{l}
R-S = \{t | t \in R \wedge  t \notin S \}\\
其中，t是元组
\end{array} 
$$
$R-S$ 与$S-R$是不同的

## 广义笛卡尔积(Cartesian Product)

定义：关系$R (<a_{1} , a_{2}, …, a_{n}>)$ 与关系$S(<b_{1}, b_{2}, …, b_{m}>)$ 的广义笛卡尔积(简称广义积, 或积, 或笛卡尔积) 运算结果也是一个关系，记作：$R \times S$, 它由关系$R$中的元组与关系$S$的元组进行所有可能的拼接(或串接)构成。其数学描述:
$$
\begin{array}{l}
R \times S = \{<a_{1}, a_{2}, …, a_{n}, b_{1}, b_{2}, …, b_{m}> & | \\
<a_{1}, a_{2}, …, a_{n}> \in R \ \wedge <b_{1}, b_{2}, …, b_{m}> \in S\}
\end{array}
$$
- $R \times S = S \times R$
- 两个关系$R$和$S$，它们的属性个数分别为$n$和$m$($R$是$n$度关系，$S$是$m$ 度关系), 则笛卡尔积 $R \times S$ 的属性个数 = $n + m$。即元组的前n个分量是R中元组的分量，后m个分量是S中元组的分量($R \times S$是$n+m$度关系).
- 两个关系$R$和$S$，它们的元组个数分别为$x$和$y$(关系$R$的基数$x$, $S$的基数$y$ ), 则笛卡尔积$R \times S$ 的元组个数 = $x  \times y$。($R \times S$的基数是$x \times y$).

## 选择(Select)
定义：给定一个关系R, 同时给定一个选择的条件condition(简记con), 选择运算结果也是一个关系，记作$\sigma_{con}(R)$, 它从关系R中选择出满足给定条件condition的元组构成。其数学描述
$$
\sigma_{con}(R) = \{t|t \in R \wedge con(t) = '真'\}
$$
- 设$R(A_{1} ,A_{2} , … ,A_{n})$, t是R的元组, t的分量记为$t[A_{i}]$, 或简写为$A_{i}$
- 条件con由逻辑运算符连接比较表达式组成
- 逻辑运算符：$\vee, \wedge, \neg$或写为$and, or, not$。
- 比较表达式：$X \ \theta \ Y$, 其中X, Y 是t的分量、常量或简单函数, $\theta$是比较运算符, $\theta \in \{>, \ge, <, \le,  =, \ne \}$

## 投影(Project)
 定义：给定一个关系R, 投影运算结果也是一个关系，记作$\Pi_{A}(R)$, 它从关系R中选出属性包含在A中的列构成。数学描述:

$$
\begin{array}{l}
\Pi_{A_{i1}, A_{i2}, ... A_{ik}}(R) = \{<t[A_{i1}], t[A_{i2}], ... t[A_{ik}]> | t \in R\}
\end{array}
$$
- 设$R(A_{1} ,A_{2} , … ,A_{n})$
- ${A_{i1}, A_{i2}, … ,A_{ik}} \subseteq { A_{1} ,A_{2} , … ,A_{n}}$ 
- $t[A_{i}]$表示元组t中相应于属性$A_i$的分量
- 投影运算可以对原关系的列在投影后重新排列

**投影操作从给定关系中选出某些列组成新的关系, 而选择操作是从给定关系中选出某些行组成新的关系**



# 扩展操作

## 交(Intersection)
定义：假设关系R和关系S是并相容的，则关系R与关系S的交运算结果也是一个关系，记作：$R \cap S$, 它由同时出现在关系R和关系S中的元组构成。数学描述:

$$
R \cap S = \{t | t \in R \wedge t \in S \} \\
\\
其中：t是元组
$$

$R \cap S$ 和$S \cap R$运算的结果是同一个关系

交运算可以通过差运算来实现：$R \cap S = R - (R - S) = S - (S - R)$

## $\theta$连接($\theta $-Join,  Theta-Join)
定义：给定关系R和关系S, R与S的$\theta$连接运算结果也是一个关系，记作$\underset{A \theta B}{R \Join S}$，它由关系R和关系S的笛卡尔积中, 选取R中属性A与S中属性B之间满足条件的元组构成。数学描述：

$$
\underset{A \theta B}{R \Join S} = \sigma_{t[A] \ \theta \ s[B]}(R \times S)
$$
- 设$R(A_{1}, A_{2} , … ,A_{n}), A \in { A_{1} ,A_{2} , … ,A_{n}}$和 $S(B_{1} ,B_{2}, … ,B_{m}), B \in {B_{1} ,B_{2}, … ,B_{m}}$
- t是关系R中的元组，s是关系S中的元组
- 属性A和属性B具有可比性
- $\theta$是比较运算符, $\theta \in {>, \ge, <, \le,  =, \ne }$

## 等值连接(Equi-Join)
定义：给定关系R和关系S, R与S的等值连接运算结果也是一个关系，记作$\underset{A = B}{R \Join S}$ ，它由关系R和关系S的笛卡尔积中选取R中属性A与S中属性B上值相等的元组所构成。数学描述:

$$
\underset{A = B}{R \Join S} = \sigma_{t[A] = s[B]}(R \times S)
$$
- 当$\theta$-连接中运算符为“＝”时，就是等值连接，等值连接是$\theta$-连接的一个特例。

广义积的元组组合并不是都有意义的，另广义积的元组组合数目也非常庞大，因此采用$\theta$-连接/等值连接运算可大幅度降低中间结果的保存量，提高速度。

## 自然连接(Natural-Join)

定义：给定关系R和关系S, R与S的自然连接运算结果也是一个关系，记作$R \Join S$ ，它由关系R和关系S的笛卡尔积中选取相同属性组B上值相等的元组所构成。数学描述

$$
{R \Join S} = \sigma_{t[B] = s[B]}(R \times S)
$$
- 自然连接是一种特殊的等值连接
- 要求关系R和关系S必须有相同的属性组B(如R,S共有一个属性$B_{1}$,则B是$B_{1}$, 如R,S共有一组属性$B_{1}, B_{2}, …, B_{n}$，则B是这些共有的所有属性)
- $R,S$属性相同，值必须相等才能连接，即$R.B_{1} = S.B_{1} \ and \ R.B_{2}=S.B_{2} … \ and \ R.B_{n} = S.B_{n}$才能连接
- 要在结果中去掉重复的属性列(因结果中$R.B_{i}$ 始终是等于$S.B_{i}$ 所以可只保留一列即可)



# 复杂扩展操作

除、$\theta$连接、等值连接和自然连接是关系代数的复杂扩展操作

## 除(Division)
除法运算经常用于求解“查询… 全部的/所有的…”问题

前提条件：给定关系$R(A_{1} ,A_{2}, …, A_{n})$为n度关系, 关系$S(B_{1}, B_{2}, …,B_{m})$为m度关系 。如果可以进行关系R与关系S的除运算，当且仅当：属性集$\{B_{1}, B_{2}, …, B_{m}\}$是属性集$\{A_{1}, A_{2}, …, A_{n}\}$的真子集，即$m < n$

定义：关系R和关系S的除运算结果也是一个关系，记作$R \div S$，分两部分来定义,
- 先定义$R \div S $结果的属性应有哪些？设属性集$\{C_{1}, C_{2}, … ,C_{k}\} = \{A_{1}, A_{2}, …, A_{n}\} \ – \ \{B_{1}, B_{2}, …, B_{m}\}$, 则有$k=n–m$则$R \div S$结果关系是k度(n-m度)关系，由$\{C_{1}, C_{2}, … ,C_{k}\}$属性构成
- 再定义$R \div S$的元组怎样形成？再设关系$R(<a_{1}, …, a_{n}>)$和关系$S (<b_{1}, …, b_{m}>)$, 那么$R \div S$结果关系为元组$<c_1, …, c_k>$的集合，元组$<c_1, …, c_k>$满足下述条件：它与S中每一个元组$<b_{1}, …, b_{m}>$组合形成的一个新元组都是R中的某一个元组$<a_{1}, …, a_{n}>$ 。(其中，$a_{1}, …, a_{n}, b_{1}, …, b_{m}, c_{1}, …, c_{k}$分别是属性$A_{1}, … , A_{n}, \ B_{1}, … ,B_{m}, \ C_{1}, …, C_{k}$的值)

数学描述：
$$
\begin{array}{l}
{R \div S} = { t | t \in \Pi_{R-S}(R) \wedge \forall u \in S(tu \in R) }\\
= \Pi_{R-S}(R) - \Pi_{R-S}(\Pi_{R-S}(R) \times S) - R)
\end{array}
$$
## 外连接
定义：两个关系R与S进行连接时，如果关系R(或S)中的元组在S(或R)中找不到相匹配的元组，则为了避免该元组信息丢失，从而将该元组与S(或R)中假定存在的全为空值的元组形成连接，放置在结果关系中，这种连接称之为外连接(Outer Join)。

外连接 = 自然连接 (或$\theta $ 连接) + 失配的元组(与全空元组形成的连接)
外连接的形式：左外连接、右外连接、全外连接

- 左外连接(Left Outer Join) = 自然连接(或$\theta $连接) + 左侧表中失配的元组,记为$R \leftouterjoin S$
- 右外连接(Right Outer Join) = 自然连接(或$\theta $连接) + 右侧表中失配的元组, 记为$R \rightouterjoin S$
- 全外连接(Full Outer Join) = 自然连接(或$\theta $连接) + 两侧表中失配的元组, 记为$R \fullouterjoin S$

# 参考资料

1. 数据库系统基础教程(第3版)
2. 