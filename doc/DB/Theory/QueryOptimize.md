数据库查询优化技术主要包括

1. 查询重用技术。根据实际情况进行配置，可缓存查询执行计划、查询结果等。
2. 查询重写规则
3. 查询算法优化技术
4. 并行查询优化技术
5. 分布式查询优化技术
6. 其他方面（如框架结构）的优化技术。

这6项技术构成了一个“广义的数据库查询优化”的概念。“查询重写规则”和“查询算法优化”，这是多数书籍在提及“数据库查询优化”时所限定的范围。从优化的内容角度看，查询优化又分为代数优化和非代数优化，或称为逻辑优化和物理优化。

查询优化引擎能做什么样的查询优化操作。这第1章的重点内容，将全面指明查询优化技术的范围，以期建立查询优化技术的全局概念。



查询优化引擎为什么能进行查询优化。这是第2章和第3章的重点内容，将从理论的角度出发进行介绍。其中第2章介绍逻辑优化包括的具体技术、为什么可做逻辑优化，以及怎么做逻辑优化；第3章介绍物理优化的具体技术、为什么可做物理优化，以及怎么做物理优化。

# 查询重用

查询重用是指尽可能利用先前的执行结果，以达到节约查询计算全过程的时间并减少资源消耗的目的。目前查询重用技术主要集中在两个方面：

1. 查询结果的重用。在缓存区中分配一块缓冲块，存放该SQL语句文本和最后的结果集，当遇到同样的SQL输入时，可直接把结果返回。查询结果的重用技术节约了查询计划生成时间和查询执行过程的时间，减少了查询执行全过程的资源消耗。
2. 查询计划的重用。缓存一条查询语句的执行计划及其相应语法树结构。查询计划的重用技术减少了查询计划生成的时间和资源消耗。

查询重用技术有利有弊：弊端，如结果集很大会消耗很大的内存资源，同样的SQL不同用户获取的结果集可能不完全相同；益处，节约了CPU和IO消耗。

# 查询重写

查询重写是查询语句的一种等价转换，即对于任何相关模式的任意状态都会产生相同的结果（相同的关系替代两个表达式中相应的关系，所得到的结果是相同的）。查询重写有两个目标：

1. 将查询转换为等价的、效率更高的形式，例如将效率低的谓词转换为效率高的谓词、消除重复条件等。
2. 尽量将查询重写为等价、简单且不受表顺序限制的形式，为物理查询优化阶段提供更多的选择，如视图的重写、子查询的合并转换等。

查询重写的依据，是关系代数。关系代数的等价变换规则对查询重写提供了理论上的支持。查询重写后，查询优化器可能生成多个连接路径，可以从候选者中择优。对查询优化技术进行分类，可有以下4个角度：

1. 语法级。查询语言层的优化，基于语法进行优化。
2. 代数级。查询使用形式逻辑进行优化，运用关系代数的原理进行优化。
3. 语义级。根据完整性约束，对查询语句进行语义理解，推知一些可优化的操作。
4. 物理级。物理优化技术，基于代价估算模型，比较得出各种执行方式中代价最小的。

查询重写是基于语法级、代数级、语义级的优化，可以统一归属到逻辑优化的范畴：基于代价估算模型是物理层面的优化，是从连接路径中选择代价最小的路径的过程。

查询重写技术优化思路主要包括：

- 将过程性查询转换为描述性的查询，如视图重写。
- 将复杂的查询（如嵌套子查询、外连接、嵌套连接）尽可能转换为多表连接查询。
- 将效率低的谓词转换为等价的效率高的谓词（如等价谓词重写）。
- 利用等式和不等式的性质，简化WHERE、HAVING和ON条件。

# 查询优化

查询优化即求解给定查询语句的高效执行计划的过程。



# 并行查询优化

在并行数据库系统中，查询优化的目标是寻找具有最小响应时间的查询执行计划，这需要把查询工作分解为一些可以并行运行的子工作。一些商业数据库提供了并行查询的功能，用以优化查询执行操作。一个查询能否并行执行，取决于以下因素：

- 系统中的可用资源（如内存、高速缓存中的数据量等）。
- CPU的数目。
- 运算中的特定代数运算符。如A、B、C、D4个表进行连接，每个表的单表扫描可以并行进行；在生成4个表连接的查询计划过程中，可选择A和B连接的同时C和D进行连接，这样连接操作能并行运行。不同商业数据库，对查询并行的实现也不尽相同。在同一个SQL内，查询并行可以分为以下两种：
    - 操作内并行。将同一操作如单表扫描操作、两表连接操作、排序操作等分解成多个独立的子操作，由不同的CPU同时执行。
    - 操作间并行。一条SQL查询语句可以分解成多个子操作，由多个CPU执行。

# 分布式查询优化

在分布式数据库系统中，查询策略优化（主要是数据传输策略，A、B两结点的数据进行连接，是A结点数据传输到B结点或从B到A或先各自进行过滤然后再传输等）和局部处理优化（传统的单结点数据库的查询优化技术）是查询优化的重点。

在查询优化策略中，数据的通信开销是优化算法考虑的主要因素。分布式查询优化以减少传输的次数和数据量作为查询优化的目标。所以，分布式数据库系统中的代价估算模型，除了考虑CPU代价和IO代价外，还要考虑通过网络在结点间传输数据的代价。这是分布式并行查询优化技术与传统单结点数据库系统最大的不同之处。在分布式数据库系统中，代价估算模型如下：
$$
总代价 = IO代价 + CPU代价 + 通信代价
$$


# 其他优化

数据库的查询性能，还取决于其他一些因素，如数据库集群系统中的SD（Share Disk）集群和SN（Share Nothing）集群，不同的架构查询优化技术也不同。SD集群采用的是共享存储方式，在数据的读写时可能产生读写冲突，所以单表扫描会受到影响；SN集群采用的是非共享式存储方式，所以在考虑了通信代价后单结点的优化方式依然适用。